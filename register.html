<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Create Account - Star Bazaar</title>
<link rel="stylesheet" href="styles.css">
<style>
.auth-page{min-height:calc(100vh - 200px);display:flex;align-items:center;justify-content:center;padding:2rem 1rem}
.auth-card{background:#fff;border-radius:14px;box-shadow:0 4px 20px rgba(0,0,0,.12);padding:2.5rem;max-width:480px;width:100%}
.auth-card h1{color:#1E6F37;margin-bottom:1.5rem;text-align:center;font-size:1.8rem}
.auth-tabs{display:flex;gap:1rem;margin-bottom:2rem;border-bottom:2px solid #E5E7EB}
.auth-tab{flex:1;padding:0.75rem;border:none;background:transparent;color:#6B7280;font-weight:600;cursor:pointer;transition:all .3s;border-bottom:3px solid transparent;margin-bottom:-2px}
.auth-tab.active{color:#1E6F37;border-bottom-color:#39B54A}
.auth-tab:hover{color:#1E6F37}
.form-errors{background:#FEE;border:1px solid #FCC;color:#C00;padding:0.75rem;border-radius:8px;margin-bottom:1rem;font-size:0.9rem}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
label{display:block;margin-bottom:1rem;color:#1F2937;font-weight:500}
label input{display:block;width:100%;margin-top:0.5rem;padding:0.75rem;border:1px solid #D1D5DB;border-radius:8px;font-size:1rem;transition:border-color .3s}
label input:focus{outline:none;border-color:#39B54A;box-shadow:0 0 0 3px rgba(57,181,74,0.1)}
label input[readonly]{background:#F9FAFB;color:#6B7280}
.btn-primary,.btn-ghost{width:100%;padding:0.875rem;border-radius:8px;font-weight:600;font-size:1rem;cursor:pointer;transition:all .3s;border:none}
.btn-primary{background:#39B54A;color:#fff;margin-bottom:1rem}
.btn-primary:hover{background:#2d8a3a;transform:translateY(-2px);box-shadow:0 4px 12px rgba(57,181,74,0.3)}
.btn-ghost{background:#F3F4F6;color:#1F2937;display:flex;align-items:center;justify-content:center;gap:0.5rem}
.btn-ghost:hover{background:#E5E7EB}
.auth-footer{text-align:center;margin-top:1.5rem;color:#6B7280}
.auth-footer a{color:#1E6F37;text-decoration:none;font-weight:600}
.auth-footer a:hover{text-decoration:underline}
.notice-bar{background:#FEF3C7;border-left:4px solid #F59E0B;padding:1rem;margin:1rem 0;color:#92400E;font-size:0.95rem}
.notice-bar a{color:#1E6F37;font-weight:600;text-decoration:none}
.notice-bar a:hover{text-decoration:underline}
.muted{color:#6B7280;font-size:0.92rem}
@media (max-width:768px){.grid{grid-template-columns:1fr}}
</style>
</head>
<body data-page="register">
<nav class="top-nav"><div class="nav-container"><div class="nav-logo"><a href="index.html" class="brand"><img src="logo.png" alt="Star Bazaar" class="logo-img"></a></div><div class="nav-search"><input type="search" id="searchInput" placeholder="Search for products..."><button type="button" id="searchBtn">üîç</button></div><div class="nav-links"><a href="index.html" class="nav-link" data-page="home">Home</a><a href="about.html" class="nav-link" data-page="about">About</a><a href="kitchen.html" class="nav-link" data-page="kitchen">Kitchen</a><a href="login.html" class="nav-link" data-page="login">Login</a><a href="register.html" class="nav-link" data-page="register">Register</a><a href="profile.html" class="nav-link" data-page="profile">Profile</a><a href="#" class="nav-link cart-link" data-page="cart">üõí Cart <span id="cartCount" class="cart-badge">0</span></a></div></div></nav>

<div id="require-phone-bar" class="notice-bar" style="display:none;">
Please add your mobile number in <a href="profile.html">Profile</a> to complete your account.
</div>

<main class="auth-page">
<div class="auth-card">
<h1>Create your account</h1>

<div class="auth-tabs">
<button class="auth-tab active" data-tab="email-form">Register with Email</button>
<button class="auth-tab" data-tab="google-form">Register with Google</button>
</div>

<div id="email-form" class="tab-content" style="display:block;">
<form id="register-form" novalidate>
<div class="form-errors" style="display:none;" role="alert" aria-live="polite"></div>
<div class="grid">
<label>First name *<input name="firstName" required autocomplete="given-name" /></label>
<label>Last name *<input name="lastName" required autocomplete="family-name" /></label>
</div>
<label>Register email *<input name="email" type="email" required autocomplete="email" /></label>
<label>Mobile number *<input name="phone" inputmode="tel" placeholder="+1 (732) 356-3000" autocomplete="tel" required aria-required="true" /></label>
<button type="submit" class="btn-primary">Create account</button>
</form>
</div>

<div id="google-form" class="tab-content" style="display:none;">
<p class="muted" style="margin-bottom:1.5rem;text-align:center;">Sign up quickly with your Google account</p>
<button id="google-register" class="btn-ghost" type="button">
<svg width="20" height="20" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
Continue with Google
</button>
</div>

<div class="auth-footer">
Already have an account? <a href="login.html">Login</a>
</div>
</div>
</main>

<footer class="site-footer"><div class="container"><div class="footer-grid"><div class="footer-col"><h3>Store Timings</h3><p><strong>Monday ‚Äì Friday:</strong><br>10:00 AM ‚Äì 7:45 PM</p><p><strong>Saturday ‚Äì Sunday:</strong><br>9:30 AM ‚Äì 7:45 PM</p></div><div class="footer-col"><h3>Contact Us</h3><p>1760 Easton Ave, Somerset, NJ 08873</p><p>üìû <a href="tel:+17323563000">+1 (732) 356-3000</a></p><p>‚úâÔ∏è <a href="mailto:starbazaar@gmail.com">starbazaar@gmail.com</a></p><p>üåê <a href="https://starbigbazaar.com/" target="_blank">starbigbazaar.com</a></p></div><div class="footer-col"><h3>Quick Links</h3><p><a href="index.html">Home</a></p><p><a href="about.html">About</a></p><p><a href="kitchen.html">Kitchen</a></p></div></div><div class="footer-copyright"><p>&copy; 2025 Star Bazaar. All rights reserved.</p></div></div></footer>

<script>
function get(key,def){try{return JSON.parse(localStorage.getItem(key))}catch(e){return def}}
function set(key,val){localStorage.setItem(key,JSON.stringify(val))}
function rm(key){localStorage.removeItem(key)}
window.isLoggedIn=function(){return localStorage.getItem("sb_auth")==="true"};
window.getUser=function(){return get("sb_user",null)};
window.logout=function(){localStorage.setItem("sb_auth","false")};
window.requirePhoneNoticeActive=function(){const u=get("sb_user",null);const flag=localStorage.getItem("sb_notice_requirePhone")==="true";return!!(flag||(u&&!u.phone))};
function generateOtp(){return String(Math.floor(Math.random()*1000000)).padStart(6,"0")}
function saveOtp(destType,dest){const code=generateOtp();const expires=Date.now()+5*60*1000;set("sb_otp",{destType,dest,code,expires});return code}
function verifyOtp(input){const otp=get("sb_otp",null);if(!otp)return false;if(Date.now()>otp.expires)return false;return otp.code===String(input).trim()}
(function(){try{var path=(location.pathname||"").toLowerCase();var file=path.split("/").pop()||"index.html";var page=file==="index.html"?"home":file==="about.html"?"about":file==="kitchen.html"?"kitchen":file==="login.html"?"login":file==="register.html"?"register":file==="profile.html"?"profile":file==="cart.html"?"cart":"";document.querySelectorAll(".nav-link").forEach(function(a){var p=a.getAttribute("data-page");if(p===page)a.classList.add("active");else a.classList.remove("active")});var brand=document.querySelector(".brand");if(brand&&brand.tagName==="A")brand.setAttribute("href","index.html")}catch(e){}})();
(function(){const bar=document.getElementById("require-phone-bar");if(bar&&window.requirePhoneNoticeActive()){bar.style.display="block"}})();
</script>

<script>
// Helper: normalize phone to +1XXXXXXXXXX or null
function normalizePhone(raw){
  if (!raw) return null;
  let s = String(raw).trim();
  if (s.startsWith('+')) s = s.replace(/[^\d+]/g,'');
  else s = s.replace(/\D/g,'');
  if (!s.startsWith('+')){
    if (s.length === 11 && s[0] === '1') s = '+' + s;
    else if (s.length === 10) s = '+1' + s;
    else return null;
  }
  return s;
}

(function(){const tabs=document.querySelectorAll(".auth-tab");const views=document.querySelectorAll(".tab-content");tabs.forEach(btn=>{btn.addEventListener("click",()=>{const target=btn.getAttribute("data-tab");tabs.forEach(b=>b.classList.toggle("active",b===btn));views.forEach(v=>v.style.display=(v.id===target?"block":"none"))})})})();

(function(){
  const form = document.querySelector("#register-form");
  if (!form) return;
  
  form.addEventListener("submit", function(e) {
    e.preventDefault();
    
    // Get form values
    const firstName = form.querySelector("[name=firstName]").value.trim();
    const lastName = form.querySelector("[name=lastName]").value.trim();
    const email = form.querySelector("[name=email]").value.trim().toLowerCase();
    const rawPhone = form.querySelector("[name=phone]").value.trim();
    
    // Validate inputs
    const errs = [];
    if (!firstName) errs.push("First name is required.");
    if (!lastName) errs.push("Last name is required.");
    if (!email || !/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(email)) {
      errs.push("Valid email is required.");
    }
    
    // Validate phone
    const phone = normalizePhone(rawPhone);
    if (!phone) {
      errs.push("Enter a valid mobile number (e.g., +1 732-356-3000).");
    }
    
    // Show errors if any
    if (errs.length) {
      showInlineError(form, errs.join(" "));
      return;
    }
    
    // Create user object
    const user = {
      firstName,
      lastName,
      email,
      phone,  // Required field
      authProvider: "email",
      createdAt: new Date().toISOString(),
      mobileVerified: true  // Mark as verified since we're requiring it at registration
    };
    
    // Save user and set auth state
    set("sb_user", user);
    localStorage.setItem("sb_auth", "true");
    localStorage.setItem("sb_notice_requirePhone", "false");  // Phone is provided
    
    // Redirect
    const returnTo = new URL(location.href).searchParams.get("returnTo");
    location.href = returnTo || "profile.html";
  });
})();

(function(){
  const btn = document.querySelector("#google-register");
  if (!btn) return;
  
  btn.addEventListener("click", async function() {
    // Get Google email
    const email = prompt("Enter your Google email:");
    if (!email || !/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(email)) {
      return alert("Enter a valid email.");
    }
    
    // Get display name
    const full = prompt("Enter your Google display name (e.g., Priya Sharma):") || "";
    const parts = full.trim().split(/\s+/);
    const firstName = parts[0] || "";
    const lastName = parts.slice(1).join(" ") || "";
    
    // Require phone number
    let phone = null;
    while (!phone) {
      const raw = prompt("Enter your mobile number (required):\nExample: +1 732-356-3000");
      if (raw === null) return; // User cancelled
      
      const norm = normalizePhone(raw);
      if (!norm) {
        alert("Please enter a valid mobile number (e.g., +1 732-356-3000).");
        continue;
      }
      phone = norm;
    }
    
    // Create user object
    const user = {
      firstName,
      lastName,
      email: email.toLowerCase(),
      phone,  // Required field
      authProvider: "google",
      createdAt: new Date().toISOString(),
      mobileVerified: true  // Mark as verified since we're requiring it
    };
    
    // Save user and set auth state
    set("sb_user", user);
    localStorage.setItem("sb_auth", "true");
    localStorage.setItem("sb_notice_requirePhone", "false");  // Phone is provided
    
    // Redirect
    const returnTo = new URL(location.href).searchParams.get("returnTo");
    location.href = returnTo || "profile.html";
  });
})();

function showInlineError(scope,msg){let box=scope.querySelector(".form-errors");if(!box){box=document.createElement("div");box.className="form-errors";box.setAttribute("aria-live","polite");scope.prepend(box)}box.style.display="block";box.textContent=msg}
</script>
<script>
// ----- Auth helpers (register page already handles OTP) -----
window.openAuthModal = function(){ location.href = "login.html?returnTo=" + encodeURIComponent(location.pathname + location.search + location.hash); };
window.openRegisterModal = function(){ location.href = "register.html?returnTo=" + encodeURIComponent(location.pathname + location.search + location.hash); };
window.requireAuth = function(next){ if (window.isLoggedIn && window.isLoggedIn()){ if (typeof next === "function") next(); return true; } window.openAuthModal(); return false; };
</script>
<script>
(function(){
  try{
    var loggedIn = window.isLoggedIn && window.isLoggedIn();
    var loginLink    = document.querySelector('.nav-link[data-page="login"]');
    var registerLink = document.querySelector('.nav-link[data-page="register"]');
    var profileLink  = document.querySelector('.nav-link[data-page="profile"]');
    if (loggedIn){
      if (loginLink)    loginLink.style.display = "none";
      if (registerLink) registerLink.style.display = "none";
      if (profileLink)  profileLink.style.display = "";
    } else {
      if (loginLink)    loginLink.style.display = "";
      if (registerLink) registerLink.style.display = "";
      if (profileLink)  profileLink.style.display = "";
    }
  }catch(e){}
})();
</script>
</body>
</html>
