<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Your Profile - Star Bazaar</title>
<link rel="stylesheet" href="styles.css">
<style>
.profile-page{min-height:calc(100vh - 200px);padding:2rem 1rem}
.profile-container{max-width:680px;margin:0 auto}
.profile-card{background:#fff;border-radius:14px;box-shadow:0 4px 20px rgba(0,0,0,.12);padding:2.5rem}
.profile-card h1{color:#1E6F37;margin-bottom:1.5rem;font-size:1.8rem}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
label{display:block;margin-bottom:1rem;color:#1F2937;font-weight:500}
label input{display:block;width:100%;margin-top:0.5rem;padding:0.75rem;border:1px solid #D1D5DB;border-radius:8px;font-size:1rem;transition:border-color .3s}
label input:focus{outline:none;border-color:#39B54A;box-shadow:0 0 0 3px rgba(57,181,74,0.1)}
label input[readonly]{background:#F9FAFB;color:#6B7280;cursor:not-allowed}
.btn-primary{width:100%;padding:0.875rem;border-radius:8px;font-weight:600;font-size:1rem;cursor:pointer;transition:all .3s;border:none;background:#39B54A;color:#fff;margin-top:1rem}
.btn-primary:hover{background:#2d8a3a;transform:translateY(-2px);box-shadow:0 4px 12px rgba(57,181,74,0.3)}
.btn{padding:0.875rem 1.5rem;border-radius:8px;font-weight:600;font-size:1rem;cursor:pointer;transition:all .3s;border:none;background:#39B54A;color:#fff;text-decoration:none;display:inline-block}
.btn:hover{background:#2d8a3a}
.notice-bar{background:#FEF3C7;border-left:4px solid #F59E0B;padding:1rem;margin:1rem 0;color:#92400E;font-size:0.95rem}
.notice-bar a{color:#1E6F37;font-weight:600;text-decoration:none}
.notice-bar a:hover{text-decoration:underline}
.profile-gate{text-align:center;padding:3rem 1rem}
.profile-gate p{color:#6B7280;margin-bottom:1.5rem;font-size:1.1rem}
.profile-info{background:#F9FAFB;padding:1rem;border-radius:8px;margin-bottom:1.5rem}
.profile-info-item{display:flex;justify-content:space-between;padding:0.5rem 0;border-bottom:1px solid #E5E7EB}
.profile-info-item:last-child{border-bottom:none}
.profile-info-label{color:#6B7280;font-size:0.9rem}
.profile-info-value{color:#1F2937;font-weight:600}
.logout-btn{background:#F3F4F6;color:#1F2937;width:100%;margin-top:1rem}
.logout-btn:hover{background:#E5E7EB;transform:none}
@media (max-width:768px){.grid{grid-template-columns:1fr}}
</style>
</head>
<body data-page="profile">
<nav class="top-nav"><div class="nav-container"><div class="nav-logo"><a href="index.html" class="brand"><img src="logo.png" alt="Star Bazaar" class="logo-img"></a></div><div class="nav-search"><input type="search" id="searchInput" placeholder="Search for products..."><button type="button" id="searchBtn">üîç</button></div><div class="nav-links"><a href="index.html" class="nav-link" data-page="home">Home</a><a href="about.html" class="nav-link" data-page="about">About</a><a href="kitchen.html" class="nav-link" data-page="kitchen">Kitchen</a><a href="login.html" class="nav-link" data-page="login">Login</a><a href="register.html" class="nav-link" data-page="register">Register</a><a href="profile.html" class="nav-link" data-page="profile">Profile</a><a href="#" class="nav-link cart-link" data-page="cart">üõí Cart <span id="cartCount" class="cart-badge">0</span></a></div></div></nav>

<div id="require-phone-bar" class="notice-bar" style="display:none;">
Please add your mobile number in <a href="profile.html">Profile</a> to complete your account.
</div>

<main class="profile-page">
<div class="profile-container">

<div id="profile-gate" class="profile-card profile-gate" style="display:none;">
<h1>Your Profile</h1>
<p>You're not logged in. Please login to view and manage your profile.</p>
<a class="btn" href="login.html?returnTo=profile.html">Login</a>
</div>

<div id="profile-content" style="display:none;">
<div class="profile-card">
<h1>Your Profile</h1>

<div class="profile-info">
<div class="profile-info-item">
<span class="profile-info-label">Account type</span>
<span class="profile-info-value" id="auth-provider">Email</span>
</div>
<div class="profile-info-item">
<span class="profile-info-label">Member since</span>
<span class="profile-info-value" id="created-at">-</span>
</div>
<div class="profile-info-item">
<span class="profile-info-label">Mobile verified</span>
<span class="profile-info-value" id="mobile-verified">No</span>
</div>
</div>

<form id="profile-form" novalidate>
<div class="grid">
<label>First name *<input name="firstName" required autocomplete="given-name" /></label>
<label>Last name *<input name="lastName" required autocomplete="family-name" /></label>
</div>
<label>Email address<input name="email" type="email" readonly autocomplete="email" /></label>
<label>Mobile number<input name="phone" inputmode="tel" placeholder="+1 (732) 356-3000" autocomplete="tel" /></label>
<p style="color:#6B7280;font-size:0.9rem;margin-top:-0.5rem;">Adding your mobile number helps us send order updates and offers.</p>
<button class="btn-primary" type="submit">Save changes</button>
<button class="btn-primary logout-btn" type="button" onclick="handleLogout()">Logout</button>
</form>
</div>
</div>

</div>
</main>

<footer class="site-footer"><div class="container"><div class="footer-grid"><div class="footer-col"><h3>Store Timings</h3><p><strong>Monday ‚Äì Friday:</strong><br>10:00 AM ‚Äì 7:45 PM</p><p><strong>Saturday ‚Äì Sunday:</strong><br>9:30 AM ‚Äì 7:45 PM</p></div><div class="footer-col"><h3>Contact Us</h3><p>1760 Easton Ave, Somerset, NJ 08873</p><p>üìû <a href="tel:+17323563000">+1 (732) 356-3000</a></p><p>‚úâÔ∏è <a href="mailto:starbazaar@gmail.com">starbazaar@gmail.com</a></p><p>üåê <a href="https://starbigbazaar.com/" target="_blank">starbigbazaar.com</a></p></div><div class="footer-col"><h3>Quick Links</h3><p><a href="index.html">Home</a></p><p><a href="about.html">About</a></p><p><a href="kitchen.html">Kitchen</a></p></div></div><div class="footer-copyright"><p>&copy; 2025 Star Bazaar. All rights reserved.</p></div></div></footer>

<script>
function get(key,def){try{return JSON.parse(localStorage.getItem(key))}catch(e){return def}}
function set(key,val){localStorage.setItem(key,JSON.stringify(val))}
function rm(key){localStorage.removeItem(key)}
window.isLoggedIn=function(){return localStorage.getItem("sb_auth")==="true"};
window.getUser=function(){return get("sb_user",null)};
window.logout=function(){localStorage.setItem("sb_auth","false")};
window.requirePhoneNoticeActive=function(){const u=get("sb_user",null);const flag=localStorage.getItem("sb_notice_requirePhone")==="true";return!!(flag||(u&&!u.phone))};
function generateOtp(){return String(Math.floor(Math.random()*1000000)).padStart(6,"0")}
function saveOtp(destType,dest){const code=generateOtp();const expires=Date.now()+5*60*1000;set("sb_otp",{destType,dest,code,expires});return code}
function verifyOtp(input){const otp=get("sb_otp",null);if(!otp)return false;if(Date.now()>otp.expires)return false;return otp.code===String(input).trim()}
(function(){try{var path=(location.pathname||"").toLowerCase();var file=path.split("/").pop()||"index.html";var page=file==="index.html"?"home":file==="about.html"?"about":file==="kitchen.html"?"kitchen":file==="login.html"?"login":file==="register.html"?"register":file==="profile.html"?"profile":file==="cart.html"?"cart":"";document.querySelectorAll(".nav-link").forEach(function(a){var p=a.getAttribute("data-page");if(p===page)a.classList.add("active");else a.classList.remove("active")});var brand=document.querySelector(".brand");if(brand&&brand.tagName==="A")brand.setAttribute("href","index.html")}catch(e){}})();
</script>

<script>
// Helper: normalize phone to +1XXXXXXXXXX or null
function normalizePhone(raw){
  if (!raw) return null;
  let s = String(raw).trim();
  if (s.startsWith('+')) s = s.replace(/[^\d+]/g,'');
  else s = s.replace(/\D/g,'');
  if (!s.startsWith('+')){
    if (s.length === 11 && s[0] === '1') s = '+' + s;
    else if (s.length === 10) s = '+1' + s;
    else return null;
  }
  return s;
}

function handleLogout(){if(confirm("Are you sure you want to logout?")){window.logout();location.href="index.html"}}

(function(){const wrap=document.querySelector("#profile-form");const gate=document.querySelector("#profile-gate");const content=document.querySelector("#profile-content");const bar=document.querySelector("#require-phone-bar");

if(!window.isLoggedIn()){if(gate){gate.style.display="block"}if(content){content.style.display="none"}return}

if(gate){gate.style.display="none"}if(content){content.style.display="block"}

const u=window.getUser()||{};
const fn=wrap.querySelector("[name=firstName]");const ln=wrap.querySelector("[name=lastName]");const em=wrap.querySelector("[name=email]");const ph=wrap.querySelector("[name=phone]");

fn.value=u.firstName||"";ln.value=u.lastName||"";em.value=u.email||"";ph.value=u.phone||"";

document.getElementById("auth-provider").textContent=(u.authProvider==="google"?"Google":"Email");
if(u.createdAt){const d=new Date(u.createdAt);document.getElementById("created-at").textContent=d.toLocaleDateString()}
document.getElementById("mobile-verified").textContent=u.mobileVerified?"Yes":"No";

const needsPhone=window.requirePhoneNoticeActive();if(bar){bar.style.display=needsPhone?"block":"none"}

wrap.addEventListener("submit",function(e){e.preventDefault();const rawPhone=ph.value.trim();const phone=normalizePhone(rawPhone);const updated={...u,firstName:fn.value.trim(),lastName:ln.value.trim(),email:(em.value||"").trim().toLowerCase(),phone,mobileVerified:!!phone};set("sb_user",updated);if(phone){localStorage.setItem("sb_notice_requirePhone","false");document.getElementById("mobile-verified").textContent="Yes"}alert("Saved");if(bar){bar.style.display=window.requirePhoneNoticeActive()?"block":"none"}})})();
</script>
<script>
// ----- Auth helpers (profile page requires login) -----
window.openAuthModal = function(){ location.href = "login.html?returnTo=" + encodeURIComponent(location.pathname + location.search + location.hash); };
window.openRegisterModal = function(){ location.href = "register.html?returnTo=" + encodeURIComponent(location.pathname + location.search + location.hash); };
window.requireAuth = function(next){ if (window.isLoggedIn && window.isLoggedIn()){ if (typeof next === "function") next(); return true; } window.openAuthModal(); return false; };
</script>
<script>
(function(){
  try{
    var loggedIn = window.isLoggedIn && window.isLoggedIn();
    var loginLink    = document.querySelector('.nav-link[data-page="login"]');
    var registerLink = document.querySelector('.nav-link[data-page="register"]');
    var profileLink  = document.querySelector('.nav-link[data-page="profile"]');
    if (loggedIn){
      if (loginLink)    loginLink.style.display = "none";
      if (registerLink) registerLink.style.display = "none";
      if (profileLink)  profileLink.style.display = "";
    } else {
      if (loginLink)    loginLink.style.display = "";
      if (registerLink) registerLink.style.display = "";
      if (profileLink)  profileLink.style.display = "";
    }
  }catch(e){}
})();
</script>
</body>
</html>
